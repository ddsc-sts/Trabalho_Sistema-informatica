CREATE DATABASE IF NOT EXISTS danle_tech CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE danle_tech;

CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(120) NOT NULL,
  email VARCHAR(255) NOT NULL UNIQUE,
  password_hash VARCHAR(255) NOT NULL,
  is_admin TINYINT(1) NOT NULL DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE products (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  price DECIMAL(10,2) NOT NULL DEFAULT 0.00,
  stock INT NOT NULL DEFAULT 0,
  image_url VARCHAR(512),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE orders (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  total DECIMAL(10,2) NOT NULL,
  payment_method ENUM('dinheiro','cartao','pix') NOT NULL,
  status ENUM('pendente','processando','concluido') NOT NULL DEFAULT 'pendente',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE order_items (
  id INT AUTO_INCREMENT PRIMARY KEY,
  order_id INT NOT NULL,
  product_id INT NOT NULL,
  quantity INT NOT NULL,
  price DECIMAL(10,2) NOT NULL,
  FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  FOREIGN KEY (product_id) REFERENCES products(id)
);

CREATE TABLE maintenance (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  title VARCHAR(255),
  description TEXT,
  status ENUM('pendente','em_progresso','pronto') DEFAULT 'pendente',
  expected_delivery DATE DEFAULT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE logs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT,
  action VARCHAR(255),
  details TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);



INSERT INTO users (name, email, password_hash, is_admin)
VALUES (
    'Admin',
    'admin@example.com',
    'scrypt:32768:8:1$9AaVmX1IbEkHkchX$83c11547edfb65428c62a787cfe022f7b64e224d5ad02510bfd1c4187a8989f5081c9b61fef46fefd12e268e8985a900d7b3dbbacc30b58c94c4f7a60189869e',
    1
);


-- Inserção de produtos
INSERT INTO products (name, description, price, stock) VALUES
('Mouse Gamer RGB', 'Mouse ergonômico com 6 botões e LED RGB', 99.90, 10),
('Teclado Mecânico', 'Teclado com switches azuis e iluminação RGB', 249.90, 8),
('Headset Surround 7.1', 'Headset com microfone removível e som 7.1', 199.90, 5),
('SSD 480GB', 'SSD SATA 480GB com alta velocidade de leitura', 279.90, 15),
('Monitor 24"', 'Monitor Full HD 24 polegadas com 75Hz', 699.90, 7);

select * from orders;

SELECT id, user_id, total, payment_method, status FROM orders ORDER BY id DESC LIMIT 5;
SELECT image_url FROM products;

ALTER TABLE products ADD COLUMN description TEXT;
ALTER TABLE products ADD COLUMN category VARCHAR(100);

SELECT id, name FROM products;

